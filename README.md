# Очереди Ларавел
## Развернуть проект локально:
1. После клонирование репозитория, следует установить composer зависимости (в проекте использовался composer версии 2.5.5 | php версии 8.2.9 | Laravel 10 | mysql версии 8 )
2. Осуществите разверните .env (установите QUEUE_CONNECTION=database), поставьте ваши значения для почтовой рассылки 
3. Осуществите миграции командой ``` php artisan migrate ```
4. Запустите сервер очередей командой ``` php artisan queue:work ``` (данный варинат подойдет на локальной работы, для продакшен среды лучше использовать 
[supervisor](https://stackoverflow.com/questions/63953381/how-to-use-supervisor-to-process-jobs-in-laravel))

## Что делает данное приложение:
1. Команда ``` php artisan user:member ``` :
* Запрашивает user_id пользователя
* Запрашивает group_id пользователя
А затем - добавляет пользователя user_id в группу group_id, если пользователь не активен (active == false), активировать его (active = true)
2. Команда  ``` php artisan user:check_expiration ``` делает:
* всех пользователей исключаеь из групп, у которых expired_at меньше текущего момента времени
* по факту исключения пользователя из группы отосылает email пользователю: Здравствуйте name! Истекло время вашего участия в группе name.
* по факту исключения пользователя из группы ставит в очередь задачу: если пользователь не входит ни в одну группу, деактивировать его (установить у пользователя active = false).

*** Есть возможность запускать второю команду раз в десять минут *** :
### Есть два способы запустить:
1. В режиме отладки локально через команду ``` php artisan schedule:work ``` (сейчас поставил в файле app/Console/Kernel.php каждую минуту, чтобы удобнее тестить результат, можно изменить конечно же на 10)
2. В продакшен среде лушче запускать через крон:
* Команда ``` crontab -e ```  
* записать в файл ``` */10 * * * * php /путь/до/проекта/artisan schedule:run >> /путь/до/лог/файл.log 2>&1 ```
